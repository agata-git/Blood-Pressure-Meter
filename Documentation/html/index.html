<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Blood Pressure Meter: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Blood Pressure Meter
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Blood Pressure Meter Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Agata Pawlowska <br />
 <a href="#" onclick="location.href='mai'+'lto:'+'aga'+'ta'+'.pa'+'wl'+'ows'+'ka'+'07@'+'gm'+'ail'+'.c'+'om'; return false;">agata<span style="display: none;">.nosp@m.</span>.paw<span style="display: none;">.nosp@m.</span>lowsk<span style="display: none;">.nosp@m.</span>a07@<span style="display: none;">.nosp@m.</span>gmail<span style="display: none;">.nosp@m.</span>.com</a> </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU Public License </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0 <br />
 </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Device described here is student's experimental project. Do not rely on measurements taken by device like this one. <br />
</dd></dl>
<p><br />
</p>
<h1><a class="anchor" id="hardware_design"></a>
Hardware design</h1>
<h2><a class="anchor" id="diagram"></a>
Block diagram</h2>
<div class="image">
<img src="BloodPressureMeter_png.png" alt="BloodPressureMeter_png.png"/>
</div>
<p> <br />
 </p>
<h2><a class="anchor" id="list"></a>
List of parts</h2>
<ul>
<li>NUCLEO F446RE</li>
<li>LCD Keypad Shield</li>
<li>Honeywell Pressure Sensor ABPMANN005PG2A3</li>
<li>KOGE mini pump KPM14A 3V</li>
<li>KOGE electromechanical valve 3V</li>
<li>Transistor N-channel BS170</li>
<li>PNP transistor 2n2905</li>
<li>four-way splitter, control aquarium valve, plastic tubes</li>
<li>Solder breadboard, connectors</li>
<li>Hand cuff</li>
</ul>
<h2><a class="anchor" id="photos"></a>
Photos</h2>
<div class="image">
<img src="IMG_4834.png" alt="IMG_4834.png"/>
</div>
 <div class="image">
<img src="IMG_4839.png" alt="IMG_4839.png"/>
</div>
 <div class="image">
<img src="IMG_4842.png" alt="IMG_4842.png"/>
</div>
 <div class="image">
<img src="IMG_4807.png" alt="IMG_4807.png"/>
</div>
<p> <br />
</p>
<p><br />
</p>
<h1><a class="anchor" id="device_operation"></a>
Operation of the device</h1>
<video width="800" height="530" controls>
<source src="WIN_20190808_152509.mp4" type="video/mp4" align="middle">
</video> <br />
</p>
<p><br />
</p>
<h1><a class="anchor" id="meas_mechanism"></a>
Measurement mechanism</h1>
<p>During blood pressure measurement by blood pressure meter cuff placed on patient's arm must be inflated till absolute closing of artery. Then valve is opened and cuff is slowly deflated (approximetely 3-5 mmHg/s). When pressure in cuff equilibrates pressure in artery blood starts flow. This pressure can be considered as systolic pressure. When pressure in cuff drop below diastolic pressure value oscillation in cuff should disappear (what isn't entirely true as described later). </p><div class="image">
<img src="OscillometricMethodOfNIBP.png" alt="OscillometricMethodOfNIBP.png"/>
<div class="caption">
Oscillometric method of NIBP measurement. Raw pressure signal from cuff and after bandpass filtration below [1]</div></div>
<p> <br />
 In this project 180 mmHg was assumed as pressure closing artery so the cuff was pumped up to 180 mmHg. Then pump was turned off and valve was opened after 1 second delay in order to stabilize pressure sensor output. <br />
</p>
<h1><a class="anchor" id="numerical_calculations"></a>
Numerical calculations</h1>
<p>Pressure sensor used in project has digital output so all operations on signal like filtering must be performed digitally by microcontroller. All signals showed below were computed by stm32f446re microcontroller and acquired with STM Studio. Sampling frequency of pressure signal from sensor equals 250 Hz.</p>
<h2><a class="anchor" id="SYS_pressure_calc"></a>
Systolic pressure evaluation</h2>
<p>Systolic pressure was determined as value of first peak detected by sign change of first derivative of pressure signal. Since raw pressure signal contains noise which is significantly increased in differentiated signal, lowpass filtration is necessary. First choice was 3rd order IIR lowpass filter with 20Hz cut-off frequency. This filter was insufficient - abrupt changes caused by valve opening weren't damped enough as showed on a chart below. As a result that abrupt changes were detected as a first systolic peak.</p>
<div class="image">
<img src="SYSmeasurementProblem.png" alt="SYSmeasurementProblem.png"/>
</div>
<p> Usage of 4th order IIR lowpass filter with 20Hz cut-off frequency eliminated this problem, as shown on a chart below. </p><div class="image">
<img src="SYSmeasumrementfiltration.png" alt="SYSmeasumrementfiltration.png"/>
</div>
 <div class="image">
<img src="lowpassFiltered.png" alt="lowpassFiltered.png"/>
</div>
<p> On another chart we can see peak, which was detected by applied method as systolic peak. </p><div class="image">
<img src="detectedPeak.png" alt="detectedPeak.png"/>
<div class="caption">
Detected systolic peak</div></div>
 <h2><a class="anchor" id="DIA_pressure_calc"></a>
Diastolic pressure evaluation</h2>
<p>Theoretically, when pressure in cuff drop below diastolic pressure value oscillation in cuff should disappear. In fact, pulsatile blood flow still cause oscillations in partially air filled cuff. In order to detect diastolic pressure using filtered pressure signal more sophisticated procedures like computing pulse wave parameters is needed. </p><div class="image">
<img src="cuffOscillations.png" alt="cuffOscillations.png"/>
<div class="caption">
Cuff pressure and amplified cuff pressure oscillations. So = cuff pressure for sudden increase in cuff pressure oscillations. As, Am and Ad are amplitudes of cuff pressure oscillations at systolic, mean and diastolic pressures, respectively. [2]</div></div>
<p>Therefore diastolic blood pressure was calculated in simplified way, based on Systolic and MAP pressure calculations. A common method used to estimate the MAP is the following formula [3]: </p><pre class="fragment">                       MAP = DIA + 1/3(SYS â€“ DIA)
</pre><p> Where: <br />
 MAP - mean arterial pressure <br />
 SYS - systolic pressure <br />
 DIA - diastolic pressure</p>
<p>Based on this formula DIA pressure was calculated as follows: </p><pre class="fragment">                       DIA = (3*MAP - SYS)/2
</pre><p><br />
</p>
<h2><a class="anchor" id="MAP_pressure_calc"></a>
Mean Arterial Pressure evaluation</h2>
<p>Mean Arterial Pressure was determined based on pressure signal after bandpass filtration. One of the the problems was choice of appropriate bandpass filter. Two filters were tested: FIR filter with lower cut-off frequency = 2 Hz and upper cut-off frequency = 10 Hz and IIR bandpass filter with the same cut-off frequencies. Since FIR filter introduces a delay, the output signal is shifted in time with respect to the input. Group delay of applied filter is 83 so value of pressure signal 83 samples from before detected highest peak was considered as value corresponded to highest peak bandpass filtered signal.</p>
<div class="image">
<img src="signalsMAPcalculating.png" alt="signalsMAPcalculating.png"/>
<div class="caption">
Highest peaks detected in bandpassed signals and corresponding pressure values: 5658=111mmHg and 5399=69mmHg</div></div>
<p> <br />
</p>
<p>As shown in the tables below values of MAP received by this two bndpass filtered signals in most cases differ from each other. MAP values are similar or even identical only when body and respiratory movement during examination were reduced practically to zero. Filtration by IIR filter was probably more sensitive on patient movements. Besides, results gained from signal filtered by IIR filter were in most cases lower and gave really low diastolic pressure values. Furthermore, signal after filtration by IIR bandpass filter is distorted in comparison to signal after FIR filtration. Signal after FIR bandpass filter is more close to what pulse wave waveform looks like. This effect is caused by unequal group delay, nonlinear phase and fact, that computations were perform on single-precision floating-point numbers[4]. IIR filters are very fast and effective but need for resolution may be critical in some cases, particularly with digital filters, when small but significant numbers combine with large numbers [5]. Efficiency of IIR filters in comparison to FIR filters results from feedback which requires appropriate precision of computations. Therefore FIR filter was chosen. <br />
 Measurements in table below were performed on one person within one hour. Table contains values of MAP and diastolic pressure computed using signal filtered with FIR bandpass filter and MAP and diastolic pressure computed using pressure signal filtered with IIR bandpass filter as well.</p>
<table class="doxtable">
<tr>
<th></th><th align="center" colspan="2"><b>Calculations based on FIR filtered signal</b> </th><th align="center" colspan="2"><b>Calculations based on IIR filtered signal</b>  </th></tr>
<tr>
<th align="center"><b>SYS</b> </th><th align="center"><b>MAP</b> </th><th align="center"><b>DIA</b> </th><th align="center"><b>MAP</b> </th><th align="center"><b>DIA</b>  </th></tr>
<tr>
<td align="center">106 </td><td align="center">78 </td><td align="center">64 </td><td align="center">73 </td><td align="center">57  </td></tr>
<tr>
<td align="center">107 </td><td align="center">81 </td><td align="center">68 </td><td align="center">75 </td><td align="center">59  </td></tr>
<tr>
<td align="center">111 </td><td align="center">80 </td><td align="center">64 </td><td align="center">69 </td><td align="center">48  </td></tr>
<tr>
<td align="center">112 </td><td align="center">79 </td><td align="center">62 </td><td align="center">74 </td><td align="center">55  </td></tr>
<tr>
<td align="center">112 </td><td align="center">77 </td><td align="center">59 </td><td align="center">69 </td><td align="center">48  </td></tr>
<tr>
<td align="center">107 </td><td align="center">78 </td><td align="center">63 </td><td align="center">78 </td><td align="center">63  </td></tr>
<tr>
<td align="center">113 </td><td align="center">85 </td><td align="center">72 </td><td align="center">72 </td><td align="center">52  </td></tr>
<tr>
<td align="center">104 </td><td align="center">79 </td><td align="center">67 </td><td align="center">79 </td><td align="center">67  </td></tr>
<tr>
<td align="center">113 </td><td align="center">87 </td><td align="center">74 </td><td align="center">74 </td><td align="center">55  </td></tr>
<tr>
<td align="center">112 </td><td align="center">84 </td><td align="center">70 </td><td align="center">73 </td><td align="center">54  </td></tr>
</table>
<p><br />
</p>
<h1><a class="anchor" id="chart"></a>
Blood pressure chart</h1>
<div class="image">
<img src="blood-pressure-chart.png" alt="blood-pressure-chart.png"/>
<div class="caption">
Blood pressure chart [6]</div></div>
<h1><a class="anchor" id="references"></a>
References</h1>
<ol type="1">
<li>PETRIE, J. C., O'BRIEN, E. T., LITTLER, W. A. and D~ SwErr, M. (1986): 'British Hypertensive Society: Recommendations on blood pressure measurements', Br. Med. J , 293, pp. 611-615</li>
<li>Leslie Alexander Geddes, M H Voelz, Christopher L. Combs, David S. Reiner, Charles F. Babbs: Characterization of the oscillometric method for measuring indirect blood pressure, DOI:10.1007/BF02367308, Published in Annals of Biomedical Engineering 1982</li>
<li><a href="https://www.ncbi.nlm.nih.gov/books/NBK538226/">https://www.ncbi.nlm.nih.gov/books/NBK538226/</a></li>
<li>Steven W. Smith: Digital Signal Processing - A Practical Guide for Engineers and Scientists, 2002</li>
<li><a href="https://www.rane.com/note157.html">https://www.rane.com/note157.html</a></li>
<li><a href="https://universityhealthnews.com/daily/heart-health/blood-pressure-chart-where-do-your-numbers-fit/">https://universityhealthnews.com/daily/heart-health/blood-pressure-chart-where-do-your-numbers-fit/</a> </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
